# API Reference ContentAI

Цей документ містить опис всіх API-ендпоінтів, доступних у проєкті ContentAI.

## Базовий URL

```
http://localhost:5001
```

## Автентифікація

Більшість ендпоінтів вимагають автентифікації за допомогою JWT-токена. Токен потрібно передавати в заголовку `Authorization` у форматі `Bearer {token}`.

Приклад:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Ендпоінти

### Автентифікація

#### Реєстрація

```
POST /signup
```

Створює нового користувача.

**Параметри запиту:**

| Параметр | Тип | Опис |
|----------|-----|------|
| email | string | Email користувача |
| password | string | Пароль користувача |

**Приклад запиту:**

```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Приклад відповіді:**

```json
{
  "message": "Користувач успішно зареєстрований"
}
```

**Коди відповіді:**

| Код | Опис |
|-----|------|
| 201 | Користувач успішно створений |
| 400 | Відсутні дані для реєстрації або користувач з таким email вже існує |

#### Вхід

```
POST /login
```

Автентифікує користувача та повертає JWT-токен.

**Параметри запиту:**

| Параметр | Тип | Опис |
|----------|-----|------|
| email | string | Email користувача |
| password | string | Пароль користувача |

**Приклад запиту:**

```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Приклад відповіді:**

```json
{
  "message": "Вхід успішний",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user_id": 1,
  "email": "user@example.com",
  "is_subscribed": true
}
```

**Коди відповіді:**

| Код | Опис |
|-----|------|
| 200 | Вхід успішний |
| 400 | Відсутні дані для входу |
| 401 | Невірний email або пароль |

### Підписки

#### Перевірка підписки

```
GET /subscription
```

Повертає інформацію про підписку користувача.

**Заголовки:**

| Заголовок | Значення |
|-----------|----------|
| Authorization | Bearer {token} |

**Приклад відповіді:**

```json
{
  "subscription_type": "premium",
  "is_active": true,
  "subscription_end": "2023-12-31T23:59:59Z"
}
```

**Коди відповіді:**

| Код | Опис |
|-----|------|
| 200 | Успішно |
| 401 | Не авторизовано |

#### Оновлення підписки

```
POST /subscription
```

Оновлює підписку користувача.

**Заголовки:**

| Заголовок | Значення |
|-----------|----------|
| Authorization | Bearer {token} |

**Параметри запиту:**

| Параметр | Тип | Опис |
|----------|-----|------|
| subscription_type | string | Тип підписки (`premium` або `free`) |
| payment_method | string | Метод оплати (`wise` або `stripe`) |

**Приклад запиту:**

```json
{
  "subscription_type": "premium",
  "payment_method": "wise"
}
```

**Приклад відповіді:**

```json
{
  "message": "Запит на оновлення підписки створено",
  "payment_url": "https://example.com/payment",
  "payment_id": "payment_123456"
}
```

**Коди відповіді:**

| Код | Опис |
|-----|------|
| 200 | Запит на оновлення підписки створено |
| 400 | Невірні параметри запиту |
| 401 | Не авторизовано |
| 500 | Помилка сервера |

#### Перевірка статусу платежу

```
GET /payment/{payment_id}
```

Перевіряє статус платежу та оновлює підписку, якщо платіж успішний.

**Заголовки:**

| Заголовок | Значення |
|-----------|----------|
| Authorization | Bearer {token} |

**Параметри шляху:**

| Параметр | Опис |
|----------|------|
| payment_id | ID платежу |

**Приклад відповіді:**

```json
{
  "status": "completed",
  "message": "Платіж успішно оброблено, підписку оновлено"
}
```

**Коди відповіді:**

| Код | Опис |
|-----|------|
| 200 | Успішно |
| 401 | Не авторизовано |
| 404 | Платіж не знайдено |
| 500 | Помилка сервера |

### Генерація контенту

#### Генерація ідей

```
POST /generate
```

Генерує ідеї для контенту.

**Заголовки:**

| Заголовок | Значення |
|-----------|----------|
| Authorization | Bearer {token} |

**Параметри запиту:**

| Параметр | Тип | Опис |
|----------|-----|------|
| platform | string | Платформа для контенту (наприклад, `instagram`, `tiktok`, `youtube`) |
| niche | string | Ніша контенту |
| audience | string | Цільова аудиторія |
| style | string | Стиль контенту |
| lang | string | Мова контенту (за замовчуванням `uk`) |

**Приклад запиту:**

```json
{
  "platform": "instagram",
  "niche": "fitness",
  "audience": "women 25-35",
  "style": "motivational",
  "lang": "uk"
}
```

**Приклад відповіді:**

```json
{
  "success": true,
  "message": "Ідеї успішно згенеровано",
  "ideas": [
    {
      "title": "5 простих вправ для ранкової зарядки",
      "description": "Покажіть 5 простих вправ, які можна виконувати вранці для заряду енергією на весь день."
    },
    {
      "title": "Здорове харчування для зайнятих жінок",
      "description": "Поділіться рецептами швидких і здорових страв, які можна приготувати за 15 хвилин."
    }
  ]
}
```

**Коди відповіді:**

| Код | Опис |
|-----|------|
| 200 | Ідеї успішно згенеровано |
| 400 | Невірні параметри запиту |
| 401 | Не авторизовано |
| 403 | Для генерації ідей потрібна активна підписка |
| 500 | Помилка сервера |

#### Отримання трендів

```
POST /trends
```

Отримує тренди для контенту.

**Заголовки:**

| Заголовок | Значення |
|-----------|----------|
| Authorization | Bearer {token} |

**Параметри запиту:**

| Параметр | Тип | Опис |
|----------|-----|------|
| niche | string | Ніша контенту |
| platform | string | Платформа для контенту (необов'язково) |
| lang | string | Мова контенту (за замовчуванням `uk`) |

**Приклад запиту:**

```json
{
  "niche": "fitness",
  "platform": "instagram",
  "lang": "uk"
}
```

**Приклад відповіді:**

```json
{
  "success": true,
  "message": "Тренди успішно отримані",
  "content": {
    "trends": [
      "Короткі відео з тренуваннями",
      "Рецепти здорового харчування",
      "Трансформації тіла до/після"
    ],
    "hashtags": [
      "#fitness",
      "#fitnessmotivation",
      "#workout",
      "#healthylifestyle",
      "#fitnessgirl"
    ]
  },
  "api_used": "openai",
  "note": ""
}
```

**Коди відповіді:**

| Код | Опис |
|-----|------|
| 200 | Тренди успішно отримані |
| 400 | Невірні параметри запиту |
| 401 | Не авторизовано |
| 403 | Для отримання трендів потрібна преміум-підписка |
| 500 | Помилка сервера |

### Здоров'я сервера

#### Перевірка здоров'я

```
GET /health
```

Перевіряє стан сервера.

**Приклад відповіді:**

```json
{
  "status": "ok",
  "version": "1.0.0",
  "uptime": "1d 2h 3m 4s"
}
```

**Коди відповіді:**

| Код | Опис |
|-----|------|
| 200 | Сервер працює нормально |
| 500 | Сервер має проблеми |

## Локалізація

Для всіх ендпоінтів можна вказати мову відповіді за допомогою параметра `lang` у запиті. Підтримувані мови:

- `uk` - українська (за замовчуванням)
- `en` - англійська

Приклад:

```
GET /subscription?lang=en
```

## Обробка помилок

У випадку помилки API повертає JSON-об'єкт з інформацією про помилку:

```json
{
  "message": "Опис помилки",
  "error": "Тип помилки",
  "status": 400
}
```

## Обмеження запитів

Для користувачів з безкоштовною підпискою діють обмеження на кількість запитів:

- Генерація ідей: 5 запитів на день
- Отримання трендів: недоступно

Для користувачів з преміум-підпискою:

- Генерація ідей: 50 запитів на день
- Отримання трендів: 10 запитів на день 